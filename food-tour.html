<!DOCTYPE html>
<html lang="es">
<head>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Food Tour</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-routing-machine/v3.2.12/Control.Geocoder.js"></script>



  <style>
    body {
      margin: 0;
      font-family: 'Trebuchet MS', sans-serif;
      color: white;
      text-align: center;
      min-height: 100vh;
      background: url('food.jpeg') no-repeat center center fixed;
      background-size: cover;
      background-color: #000;
    }

    #map {
      width: 80%;
      max-width: 100%;
      height: 500px;
      margin: 0 auto 20px;
      border: 5px solid #bb8e1e;
      box-shadow: 0 0 20px #a2802b;
      border-radius: 10px;
    }

    img[alt="Food Tour"] {
      width: 100%;
      max-height: 200px;
      object-fit: contain;
      display: block;
      margin: 0 auto 10px;
    }
.button-container {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  margin: 20px auto;
}

.map-button {
  background-color: rgba(0, 0, 0, 0.6);
  border: 2px solid white;
  color: white;
  padding: 10px 18px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}

.map-button:hover {
  background-color: rgba(255, 255, 255, 0.2);
}
 
#locateMe {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  display: block;
  margin: 10px auto;
  padding: 0;
}


#locateMe:hover {
  background-color: #ffad4d;
}


  </style>
</head>

<body>

  <img src="titlefood.png" alt="Food Tour">
  <div id="map"></div>
<button id="locateMe" title="Recenter my location"> üìç </button>
<select id="travelMode" style="padding: 6px; border-radius: 8px; font-size: 14px;">
  <option value="walking">üö∂ Walking</option>
  <option value="driving">üöó Driving</option>
</select>

<div style="margin: 10px auto;">
  <input type="text" id="searchInput" list="restaurantList" placeholder="Search restaurant..." 
       style="padding: 8px; border-radius: 8px; border: none; width: 250px; font-size: 16px;">
<datalist id="restaurantList"></datalist>

  <button onclick="buscarLugar()" 
          style="padding: 8px 12px; border-radius: 8px; border: none; background-color: #bb8e1e; color: white; font-weight: bold; cursor: pointer;">
    Search
  </button>
</div>

  <!-- Contenedor de galer√≠a con fondo desenfocado -->
<div id="galleryModal" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  overflow-y: auto;                /* ‚Üê Permite scroll */
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 2000;
  justify-content: flex-start;    /* ‚Üê Alinea arriba */
  align-items: center;
  flex-direction: column;
  padding-top: 60px;
">

  <!-- Bot√≥n de cerrar -->
  <button onclick="closeGallery()" style="
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    color: red;
    background: none;
    border: none;
    cursor: pointer;
    font-weight: bold;
  ">‚úñ</button>

  <div id="galleryContent" style="
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    max-width: 90%;
  "></div>
</div>

<!-- Botones -->
<div class="button-container">
  <button id="btnRecomendations" class="map-button">Recomendations</button>
  <button id="btnStreetFood" class="map-button">Street Food</button>
  <button id="btnHalibut" class="map-button">Halibut</button>
</div>

<script>
  // Categor√≠as con coordenadas fijas y nombres personalizados
   const categories = {
  recomendations: {
    color: 'yellow',
    coords: [
      { lat: 61.218510, lng: -149.903435, name: 'Snow City Cafe', link: 'https://snowcitycafe.com', rating: 4.5, hours: 'Monday-Sunday: 6:30AM - 3:00PM', priceRange: '$3.95 - $23' },
      { lat: 61.217962, lng: -149.904035, name: 'Simon & Seaforts', link: 'https://simonandseaforts.com', rating: 4.3, hours: 'Monday-Saturday: 11:30AM - 10:00PM / Sunday: 11AM - 9PM', priceRange: '$8.95 - $82.90' },
      { lat: 61.219555, lng: -149.895800, name: '49th State Brewing', link: 'https://www.49thstatebrewing.com/anchorage-3/', rating: 4.7, hours: 'Monday-Saturday: 11:00AM - 11:00PM', priceRange: '$3.99 - $34.99' }
    ]
  },
      streetfood: {
        color: 'orange',
        coords: [
          { lat: 61.2184, lng: -149.8975, name: 'Downtown Market', rating: 4.5, hours: 'Saturday: 10AM - 6PM / Sunday: 11AM - 5PM', priceRange: '$random' },
          { lat: 61.2192, lng: -149.8952, name: 'Anchorage Street Eats', rating: 4.5, hours: 'Monday-Sunday: random schedule', priceRange: '$random' },
          { lat: 61.2169, lng: -149.8983, name: '4th Ave Food Truck', rating: 4.5, hours: 'Monday-Sunday: random schedule', priceRange: '$random' }
        ]
      },
      halibut: {
        color: 'purple',
        coords: [
          { lat: 61.2165, lng: -149.9009, name: 'Halibut Point Grill', rating: 4.5, hours: 'Monday-Sunday: random schedule', priceRange: '$X - X1' },
          { lat: 61.2172, lng: -149.8920, name: 'The Halibut House', rating: 4.5, hours: 'Monday-Sunday: random schedule',priceRange: '$bla bla'},
          { lat: 61.2188, lng: -149.8965, name: 'Alaska Fish Tacos', rating: 4.5, hours: 'Monday-Sunday: random schedule', priceRange: '$X - X2' }
        ]
      }
    };

    const markers = {
      recomendations: [],
      streetfood: [],
      halibut: []
    };
  let map;
  let userMarker = null;
  let routingControl = null;
  let activeRouteCategory = null;
  let currentDestination = null; // Nuevo: guardamos el destino de la ruta actual

function toggleMarkers(categoryKey) {
  const cat = categories[categoryKey];
  const currentMarkers = markers[categoryKey];

  // Solo quitamos la ruta si la ruta activa pertenece a esta categor√≠a
  if (routingControl && activeRouteCategory === categoryKey) {
    map.removeControl(routingControl);
    routingControl = null;
    activeRouteCategory = null;
  }

  if (currentMarkers.length > 0) {
    currentMarkers.forEach(m => map.removeLayer(m));
    markers[categoryKey] = [];
  } else {
    cat.coords.forEach(item => {
      const marker = L.circleMarker([item.lat, item.lng], {
        radius: 8,
        color: cat.color,
        fillColor: cat.color,
        fillOpacity: 0.9
      }).addTo(map);

     let popupHTML = `
  <div style="display: flex; flex-direction: column; align-items: center;">
    <span style="color: black; font-weight: bold; font-size: 16px;">
      ${item.link 
        ? `<a href="${item.link}" target="_blank" style="color: black; text-decoration: underline;">${item.name}</a>`
        : item.name}
    </span>
    <div style="margin: 5px 0; font-size: 14px; color: black;">
      ‚≠ê ${item.rating ? item.rating.toFixed(1) : 'N/A'}
    </div>
   <div onclick="toggleHorario('horario-${item.lat}-${item.lng}')" 
         style="cursor: pointer; font-size: 18px;">‚è∞</div>
    <div id="horario-${item.lat}-${item.lng}" 
         style="display: none; font-size: 14px; color: black; margin-top: 5px;">
      ${item.hours || 'Horario no disponible'}
    </div>
     <div onclick="togglePrecio('precio-${item.lat}-${item.lng}')" style="cursor: pointer; font-size: 18px;">üí≤</div>
    <div id="precio-${item.lat}-${item.lng}" style="display: none; font-size: 14px; color: black; margin-top: 5px;">
      ${item.priceRange || 'Precio no disponible'}
    </div>
    <div id="routeInfo-${item.lat}-${item.lng}" style="font-size: 14px; color: black;"></div>
    <div style="display: flex; gap: 10px;">
   <button onclick="openVisual('${item.name}')" style="background: none; border: none; cursor: pointer; font-size: 18px;">üëÅÔ∏è</button>
  <button onclick="toggleRoute(${item.lat}, ${item.lng}, '${categoryKey}')" style="background: none; border: none; cursor: pointer; font-size: 18px;">‚û°Ô∏è</button>
</div>
  </div>
`;

      marker.bindPopup(popupHTML);
     setTimeout(() => {
  const favorites = JSON.parse(localStorage.getItem('favoritePlaces') || '[]');
  if (favorites.includes(item.name)) {
    const favBtn = document.getElementById(`fav-${item.name.replace(/\s+/g, '')}`);
    if (favBtn) favBtn.style.color = "red";
  }
}, 300); // espera a que se abra el popup

      markers[categoryKey].push(marker);
    });
  }
}


  document.addEventListener('DOMContentLoaded', () => {
    map = L.map('map').setView([61.2176, -149.8997], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
  
    function updatePosition(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      if (userMarker) {
        userMarker.setLatLng([lat, lon]);
      } else {
        userMarker = L.circleMarker([lat, lon], {
          radius: 8,
          fillColor: "#f03",
          color: "#900",
          weight: 2,
          opacity: 1,
          fillOpacity: 0.8
        }).addTo(map).bindPopup("You Are Here!").openPopup();
        map.setView([lat, lon], 15);
      }
      // Si hay una ruta activa, se actualiza autom√°ticamente con la nueva posici√≥n
if (currentDestination && userMarker && map) {
  toggleRoute(currentDestination.lat, currentDestination.lng, activeRouteCategory);
}
    }
    const datalist = document.getElementById('restaurantList');
    const allNames = [];

    Object.values(categories).forEach(cat => {
      cat.coords.forEach(item => {
        allNames.push(item.name);
      });
    });

    allNames.forEach(name => {
      const option = document.createElement('option');
      option.value = name;
      datalist.appendChild(option);
    });

    if ("geolocation" in navigator) {
      navigator.geolocation.watchPosition(updatePosition, console.warn, {
        enableHighAccuracy: true,
        maximumAge: 10000,
        timeout: 10000
      });
    }

    
    // Botones
    document.getElementById('btnRecomendations').addEventListener('click', () => {
      toggleMarkers('recomendations');
    });
    document.getElementById('btnStreetFood').addEventListener('click', () => {
      toggleMarkers('streetfood');
    });
    document.getElementById('btnHalibut').addEventListener('click', () => {
      toggleMarkers('halibut');
    });
    const locateButton = document.getElementById('locateMe');

locateButton.addEventListener('click', () => {
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(pos => {
      const { latitude, longitude } = pos.coords;
      map.setView([latitude, longitude], 15);

      if (!userMarker) {
        userMarker = L.circleMarker([latitude, longitude], {
          radius: 8,
          fillColor: "#f03",
          color: "#900",
          weight: 2,
          opacity: 1,
          fillOpacity: 0.8
        }).addTo(map).bindPopup("YOU ARE HERE!");
      } else {
        userMarker.setLatLng([latitude, longitude]);
      }
    }, error => {
      alert("No se pudo obtener tu ubicaci√≥n.");
    });
  }
});

  });
function openVisual(placeName) {
  const modal = document.getElementById('galleryModal');
  const content = document.getElementById('galleryContent');
  content.innerHTML = "";

  // Datos visuales por lugar
  const data = {
    "Snow City Cafe": {
      video: "videoSnow.mp4",
      recommendation: "scc.jpg",
      photo1: "scc1.jpg",
       menu: {
    "BREAKFAST & LUNCH": ["menuBL1.jpeg", "menuBL2.JPG"],
    "FRESH SHEET": ["menuFS1.JPG"],
    "KIDS": ["menuK1.JPG"]
  }
    },
    "Simon & Seaforts": {
      video: "videoSS.mp4",
      recommendation: "s&s1.jpg",
      photo1: "s&s.jpg",
      menu: "menuSS.jpg"
    },
    // Agrega m√°s lugares aqu√≠
  };

  const visual = data[placeName];
  if (!visual) return;

  const grid = document.createElement('div');
  grid.style.display = 'grid';
  grid.style.gridTemplateColumns = '1fr';
  grid.style.gridTemplateRows = 'auto';
  grid.style.gap = '15px';
  grid.style.justifyItems = 'center';
  grid.style.alignItems = 'center';

  const createSection = (title, contentHTML) => {
    const container = document.createElement('div');
    container.style.textAlign = 'center';
    const titleEl = document.createElement('div');
    titleEl.innerText = title;
    titleEl.style.color = 'black';
    titleEl.style.marginBottom = '5px';
    titleEl.style.fontWeight = 'bold';
    container.appendChild(titleEl);
    container.innerHTML += contentHTML;
    return container;
  };

  grid.appendChild(createSection('Video', `<video src="${visual.video}" controls style="width: 200px; border-radius: 10px;"></video>`));
  grid.appendChild(createSection('Our Recommendation', `<img src="${visual.recommendation}" style="width: 150px; border-radius: 10px;" />`));
  grid.appendChild(createSection('Photo', `<img src="${visual.photo1}" style="width: 150px; border-radius: 10px;" />`));
 const menuContainer = document.createElement('div');
menuContainer.style.textAlign = 'center';

const menuTitle = document.createElement('div');
menuTitle.innerText = 'Menu';
menuTitle.style.color = 'white';
menuTitle.style.fontWeight = 'bold';
menuTitle.style.marginBottom = '10px';
menuContainer.appendChild(menuTitle);

// Contenedor de botones
const buttonGroup = document.createElement('div');
buttonGroup.style.display = 'flex';
buttonGroup.style.gap = '10px';
buttonGroup.style.marginBottom = '10px';
buttonGroup.style.justifyContent = 'center';

const imageGrid = document.createElement('div');
imageGrid.style.display = 'flex';
imageGrid.style.gap = '10px';
imageGrid.style.flexWrap = 'wrap';
imageGrid.style.justifyContent = 'center';

Object.keys(visual.menu).forEach(menuType => {
  const btn = document.createElement('button');
  btn.innerText = menuType;
  btn.style.padding = '6px 10px';
  btn.style.borderRadius = '6px';
  btn.style.border = 'none';
  btn.style.backgroundColor = '#bb8e1e';
  btn.style.color = 'white';
  btn.style.cursor = 'pointer';
  btn.style.fontSize = '14px';

  btn.addEventListener('click', () => {
    imageGrid.innerHTML = '';
  visual.menu[menuType].forEach(imgSrc => {
  const img = document.createElement('img');
  img.src = imgSrc;
  img.style.width = '120px';
  img.style.borderRadius = '8px';
  img.style.boxShadow = '0 0 6px white';
  img.style.transition = 'transform 0.3s ease, width 0.3s ease';
  img.style.cursor = 'pointer';

  // Evento de click para agrandar o regresar al tama√±o original
  img.addEventListener('click', () => {
    if (img.classList.contains('zoomed')) {
      img.style.position = '';
      img.style.zIndex = '';
      img.style.transform = '';
      img.style.width = '120px';
      img.classList.remove('zoomed');
    } else {
      img.style.position = 'relative';
      img.style.zIndex = '9999';
      img.style.transform = 'scale(2)';
      img.style.width = '240px';
      img.classList.add('zoomed');
    }
  });

  imageGrid.appendChild(img);
});

  });

  buttonGroup.appendChild(btn);
});

menuContainer.appendChild(buttonGroup);
menuContainer.appendChild(imageGrid);
grid.appendChild(menuContainer);


  content.appendChild(grid);
  modal.style.display = 'flex';
}
function closeGallery() {
  const modal = document.getElementById('galleryModal');
  modal.style.display = 'none';
}

function buscarLugar() {
  const query = document.getElementById("searchInput").value.toLowerCase().trim();
  let encontrado = false;

  Object.keys(categories).forEach(catKey => {
    categories[catKey].coords.forEach((item, idx) => {
      if (item.name.toLowerCase().includes(query)) {
        encontrado = true;

        // Si a√∫n no existe el marcador, agregamos los de esa categor√≠a
        if (!markers[catKey][idx]) {
          toggleMarkers(catKey);

          // Esperamos a que los markers se agreguen antes de centrar el mapa
          setTimeout(() => {
            const marker = markers[catKey][idx];
            if (marker) {
              map.setView(marker.getLatLng(), 16);
              marker.openPopup();
            }
          }, 400); // Ajusta este tiempo si el mapa sigue sin enfocarse
        } else {
          // Ya existe, solo centramos y abrimos popup
          const marker = markers[catKey][idx];
          map.setView(marker.getLatLng(), 16);
          marker.openPopup();
        }
      }
    });
  });

  // Si no se encontr√≥, mostrar mensaje despu√©s de esperar
  setTimeout(() => {
    if (!encontrado) {
      alert("Restaurante no encontrado.");
    }
  }, 600);
}

// Modifica la funci√≥n toggleRoute para usar currentRoutingMode
function toggleRoute(destLat, destLng, categoryKey) {
  if (!userMarker) {
    alert("Ubicaci√≥n no disponible a√∫n.");
    return;
  }

  const userLatLng = userMarker.getLatLng();

  console.log("Creando ruta desde:", userLatLng.lat, userLatLng.lng, "hasta", destLat, destLng);

  if (
    !userLatLng || isNaN(userLatLng.lat) || isNaN(userLatLng.lng) ||
    isNaN(destLat) || isNaN(destLng)
  ) {
    console.error("Coordenadas inv√°lidas para la ruta.");
    return;
  }

  currentDestination = { lat: destLat, lng: destLng };
  activeRouteCategory = categoryKey;

  if (routingControl) {
    map.removeControl(routingControl);
    routingControl = null;
  }

 const selectedMode = document.getElementById("travelMode").value;
const profile = selectedMode === 'walking' ? 'mapbox/walking' : 'mapbox/driving';

routingControl = L.Routing.control({
  waypoints: [
    L.latLng(userLatLng.lat, userLatLng.lng),
    L.latLng(destLat, destLng)
  ],
  router: L.Routing.mapbox('pk.eyJ1IjoiYWFyb25jcnUiLCJhIjoiY21kM3FwcHBwMDdpZzJrb2hqZ3FpMWltMyJ9.mhmqWlj1VOYF0T9HPnZk_g', {
    profile: profile
  }),
  lineOptions: {
    styles: [{ color: 'blue', opacity: 0.7, weight: 5 }]
  },
  routeWhileDragging: false,
  addWaypoints: false,
  draggableWaypoints: false,
  fitSelectedRoutes: true,
  show: false,
  createMarker: () => null
}).addTo(map);



routingControl.on('routesfound', function(e) {
  if (e.routes.length > 0) {
    const route = e.routes[0];
    const summary = route.summary;
    const tiempoMin = Math.round(summary.totalTime / 60);
    const distanciaMillas = (summary.totalDistance / 1609.34).toFixed(1);

    const divId = `routeInfo-${destLat}-${destLng}`;
    const infoDiv = document.getElementById(divId);
    if (infoDiv) {
      infoDiv.innerHTML = `${tiempoMin}min/${distanciaMillas} mi`;
    }

    console.log(`${tiempoMin}min/${distanciaMillas} mi`);
  } else {
    console.warn("Ruta no encontrada.");
  }
});

}
function toggleHorario(id) {
  const el = document.getElementById(id);
  if (el) {
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
  }
}
function togglePrecio(id) {
  const el = document.getElementById(id);
  if (el) {
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
  }
}

</script>

</body>
</html>
